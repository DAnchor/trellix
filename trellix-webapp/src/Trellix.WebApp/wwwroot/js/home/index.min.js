$(window).on("DOMContentLoaded",function(){let e=new Promise(t=>{setTimeout(()=>{t(document)},10)});var t=new Promise(t=>{setTimeout(()=>{t(e)},777)});$("#x-close-add-modal").on("click",function(){$("#x-form-input").val(""),$("#x-add-modal").modal("hide")}),$("#x-add-modal").on("hide.bs.modal",function(){$("#x-form-input").val("")}),$("#x-add-attachment").on("click",function(t){t.preventDefault(),$("#x-add-modal").modal("show"),$("#x-add-modal-button").on("click",async function(){let e=$(this);e.attr("disabled",!0);var t,n=new FormData,o=$("#x-form-input").get(0).files;o[0].name.length&&(t=o[0].name.substring(0,o[0].name.lastIndexOf("."))||o[0].name,n.append("Name",t),n.append("Data",o[0]),t={method:"POST",mode:"same-origin",headers:{"Access-Control-Allow-Origin":window.location.origin},body:n},await fetch(window.location.origin+"/Attachment/CreateAttachment",t).then(e=>e.json().then(t=>({status:e.status,responseAttachment:t}))).then(t=>{console.log(t.responseAttachment),201===t.responseAttachment.statusCode&&(e.removeAttr("disabled"),$("#x-response-message").append(`<span class="text-success">${t.responseAttachment.message}</span>`),setTimeout(()=>{$("#x-response-message").html(""),window.location.reload()},5e3)),201!==t.responseAttachment.statusCode&&(e.removeAttr("disabled"),$("#x-response-message").append(`<span class="text-danger">${t.responseAttachment.message}</span>`),setTimeout(()=>{$("#x-response-message").html("")},5e3))}).catch(t=>{e.removeAttr("disabled"),$("#x-response-message").append(`<span class="text-danger">${t}</span>`),setTimeout(()=>{$("#x-response-message").html("")},5e3)}))})});async function n(){$("[id^='x-entity-counter-']").on("click",async function(t){t.preventDefault(),console.log("click");t=window.location.origin+"/Attachment/DownloadAttachment?id=";let e={method:"GET",mode:"same-origin",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":window.location.origin}},n=function(t,e){var n=document.createElement("a");n.href=encodeURI(t),n.setAttribute("download",e),n.click(),n.remove()};var o,a;return t=t,o=$(this).attr("x-prop-id"),a=$(this).attr("x-prop-file-name"),fetch(""+(t+o),e).then(t=>200===t.status?t:null).then(t=>t.blob()).then(t=>null===t?console.log("Error getting the blob."):(t=window.URL.createObjectURL(t),void n(t,a))).catch(t=>console.log(t))})}e.then(setTimeout(async()=>{var t;t=window.location.origin+"/Attachment/GetAttachments",await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.json().then(t=>({status:e.status,responseAttachmentList:t}))).then(t=>{200===t.status&&setTimeout(()=>{$("tbody").children().remove(),t.responseAttachmentList.attachments.map((t,e)=>{$("tbody").append(`<tr>
                                <th scope="row">${t.id}</th>
                                <td>${t.name}</td>
                                <td>${new Date(t.createdOn).toLocaleDateString("en-US")}</td>
                                <td>${new Date(t.modifiedOn).toLocaleDateString("en-US")}</td>
                                <td class="icon-cell">
                                    <a href="#" class="action-button-link link-dark" id="x-entity-counter-${e}" x-prop-id="${t.id}" x-prop-file-name="${t.name}" title="Download Attachment: ${t.name}">
                                        <i class="bi bi-download h6"></i>
                                    </a>
                                </td>
                            </tr>`)})},1)}).catch(t=>console.log(t))},11)).catch(t=>console.log(t)),t.then(setTimeout(async()=>{await n()},777)).catch(t=>console.log(t))});